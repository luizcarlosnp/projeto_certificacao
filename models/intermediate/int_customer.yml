version: 2

models:
  - name: int_customer
    description: "Modelo que junta informações de clientes, pessoas, endereços, estados e países para criar um relatório completo."
    columns:
      - name: cliente_id
        description: "Identificador único do cliente."
        tests:
          - unique
          - not_null
      - name: primeiro_nome
        description: "Primeiro nome da pessoa associada ao cliente."
        tests:
          - not_null
      - name: nome_do_meio
        description: "Nome do meio da pessoa associada ao cliente."
      - name: sobrenome
        description: "Sobrenome da pessoa associada ao cliente."
        tests:
          - not_null
      - name: loja_id
        description: "Identificador da loja associada ao cliente."
        tests:
          - not_null
      - name: territorio_id
        description: "Identificador do território de vendas associado ao cliente."
        tests:
          - not_null
      - name: cidade
        description: "Nome da cidade associada ao endereço do cliente."
        tests:
          - not_null
      - name: estado
        description: "Nome do estado/província associada ao endereço do cliente."
        tests:
          - not_null
      - name: pais
        description: "Nome do país associado ao endereço do cliente."
        tests:
          - not_null
      - name: codigo_postal
        description: "Código postal associado ao endereço do cliente."
        tests:
          - not_null
      - name: participa_promocoes_email
        description: "Flag que indica se o cliente participa de promoções via e-mail."
      - name: identificador_global_cliente
        description: "Identificador global único para o cliente."
        tests:
          - not_null

tests:
  - name: int_customer
    description: "Modelo que verifica se as chaves de junção estão corretas."
    tests:
      - relationship:
          to: ref('stg_erp__customer')
          field: customerid
          model_field: cliente_id
      - relationship:
          to: ref('stg_erp__person')
          field: personid
          model_field: pessoa_id
      - relationship:
          to: ref('stg_erp__address')
          field: addressid
          model_field: endereco_id
      - relationship:
          to: ref('stg_erp__stateprovince')
          field: stateprovinceid
          model_field: estado_id
      - relationship:
          to: ref('stg_erp__countryregion')
          field: countryregioncode
          model_field: codigo_pais
      - not_null:
          column_name: cliente_id
